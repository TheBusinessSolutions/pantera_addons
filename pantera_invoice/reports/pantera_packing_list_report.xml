<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="paperformat_report_packing_pantera" model="report.paperformat">
            <field name="name">Pantera Packing List</field>
            <field name="default" eval="False"/>
            <field name="format">A4</field>
            <field name="page_height">0</field>
            <field name="page_width">0</field>
            <field name="orientation">Landscape</field>
            <field name="margin_top">70</field>
            <field name="margin_bottom">20</field>
            <field name="margin_left">7</field>
            <field name="margin_right">7</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">60</field>
            <field name="dpi">90</field>
        </record>


        <template id="external_layout_packing_pantera">
            <t t-if="o and 'company_id' in o">
                <t t-set="company" t-value="o.company_id"/>
            </t>
            <t t-if="not o or not 'company_id' in o">
                <t t-set="company" t-value="res_company"/>
            </t>
            <div class="header" style="text-align: center; padding-bottom: 15px;">
                <t t-if="doc.with_context(lang='en_US').brand_id">
                    <img t-att-src="image_data_uri(doc.brand_id.image_1920)" style="width: 100%;max-height: 120px;object-fit: contain;"
                         alt="Logo"/>
                </t>
                <t t-else="">
                    <img t-att-src="image_data_uri(company.logo)" style="width: 100%;max-height: 120px;object-fit: contain;"
                         alt="Logo"/>
                </t>
            </div>

            <div class="article o_report_layout_standard">
                <t t-raw="0"/>
            </div>
            <div class="footer o_background_footer">
                <div class="text-center" style="font-size:14px;">
                    <div t-if="report_type == 'pdf'" class="text-muted">
                        Page:
                        <span class="page"/>
                        of
                        <span class="topage"/>
                    </div>
                </div>
            </div>

        </template>


        <template id="report_packing_pantera_document">
            <t t-foreach="doc" t-as="o">
                <t t-call="pantera_invoice.external_layout_packing_pantera">
                    <style>
                        td{
                        padding:5px;
                        }
                    </style>
                    <div class="page" style="font-family: 'Tajawal-Regular';">
                        <div class="row">
                            <table style="border:1px solid white;">
                                <tr style="border:0px;">
                                    <td style="border:0px;">
                                        <strong>Invoice No.:</strong>
                                    </td>
                                    <td style="border:0px;">
                                        <t t-esc="doc.name"/>
                                    </td>
                                    <td rowspan="3" style="border:0px;">
                                        <strong>Buyer:</strong>
                                    </td>
                                    <td rowspan="3" style="border:0px;">
                                        <t t-esc="doc.partner_id.name"/>
                                        <br/>
                                        <t t-if="o.partner_id.street">
                                            <t t-esc="o.partner_id.street"/>
                                        </t>
                                        <br/>
                                        <t t-esc="o.partner_id.city"/>,<t t-esc="o.partner_id.state_id.name"/>,
                                        <t t-esc="o.partner_id.country_id.name"/>
                                        <br/>
                                        <t t-if="o.partner_id.phone">
                                            <strong>Tel:</strong>
                                            <t t-esc="o.partner_id.phone"/>
                                        </t>
                                        <br/>
                                    </td>
                                </tr>
                                <tr style="border:0px;">
                                    <td style="border:0px;">
                                        <strong>Date:</strong>
                                    </td>
                                    <td style="border:0px;">
                                        <t t-esc="doc.invoice_date"/>
                                    </td>
                                </tr>
                                <tr style="border:0px;">
                                    <td style="border:0px;">
                                        <strong>Terms:</strong>
                                    </td>
                                    <td style="border:0px;">
                                        <t t-esc="doc.narration"/>
                                    </td>
                                </tr>
                                <tr style="border:0px;">
                                    <td style="border:0px;">
                                        <strong>Vessel:</strong>
                                    </td>
                                    <td style="border:0px;">
                                        <t t-esc="doc.vessel"/>
                                    </td>
                                    <td rowspan="3" style="border:0px;">
                                        <strong>Seller:</strong>
                                    </td>
                                    <td rowspan="3" style="border:0px;">
                                        <t t-esc="doc.seller_id.name"/>
                                        <br/>
                                        <t t-if="o.seller_id.street">
                                            <t t-esc="o.seller_id.street"/>
                                        </t>
                                        <br/>
                                        <t t-esc="o.seller_id.city"/>,<t t-esc="o.seller_id.state_id.name"/>,
                                        <t t-esc="o.seller_id.country_id.name"/>
                                        <br/>
                                        <t t-if="o.seller_id.phone">
                                            <strong>Tel:</strong>
                                            <t t-esc="o.seller_id.phone"/>
                                        </t>
                                        <br/>
                                    </td>
                                </tr>
                                <tr style="border:0px;">
                                </tr>
                                <tr style="border:0px;">
                                    <td style="border:0px;">
                                        <strong>Exporter:</strong>
                                    </td>
                                    <td style="border:0px;">
                                        <t t-esc="doc.exporter_id.name"/>
                                        <br/>
                                        <t t-if="o.exporter_id.street">
                                            <t t-esc="o.exporter_id.street"/>
                                        </t>
                                        <br/>
                                        <t t-esc="o.exporter_id.city"/>,<t t-esc="o.exporter_id.state_id.name"/>,
                                        <t t-esc="o.exporter_id.country_id.name"/>
                                        <br/>
                                        <t t-if="o.exporter_id.phone">
                                            <strong>Tel:</strong>
                                            <t t-esc="o.exporter_id.phone"/>
                                        </t>
                                        <br/>
                                    </td>
                                </tr>

                            </table>

                        </div>
                        <div class="row">
                            <div class="col-12" style="text-align:center;margin:5px;">
                                <strong>Packing List</strong>
                            </div>
                        </div>
                        <div class="row">
                            <table style="border:1px solid white;">
                                <tr style="border:0px;">
                                    <td style="border:0px;border-bottom:1px solid;">
                                        <strong>Container</strong>
                                    </td>
                                    <td style="border:0px;border-bottom:1px solid;">
                                        <strong>Quantity</strong>
                                    </td>
                                    <td style="border:0px;border-bottom:1px solid;">
                                        <strong>Box</strong>
                                    </td>
                                    <td style="border:0px;border-bottom:1px solid;">
                                        <strong>Product</strong>
                                    </td>
                                    <td style="border:0px;border-bottom:1px solid;">
                                        <strong>Variety</strong>
                                    </td>
                                    <td style="border:0px;border-bottom:1px solid;">
                                        <strong>Bruto</strong>
                                    </td>
                                    <td style="border:0px;border-bottom:1px solid;">
                                        <strong>Total Gross</strong>
                                    </td>
                                    <td style="border:0px;border-bottom:1px solid;">
                                        <strong>Unit</strong>
                                    </td>
                                    <td style="border:0px;border-bottom:1px solid;">
                                        <strong>Netto</strong>
                                    </td>
                                    <td style="border:0px;border-bottom:1px solid;">
                                        <strong>Total Net</strong>
                                    </td>
                                    <td style="border:0px;border-bottom:1px solid;">
                                        <strong>Unit</strong>
                                    </td>
                                </tr>
                                <t t-set="total_gross" t-value="0"/>
                                <t t-set="total_net" t-value="0"/>
                                <t t-set="total_boxes" t-value="0"/>
                                <t t-set="unique_containers" t-value="[]"/>
                                
                                <t t-foreach="doc.invoice_line_ids" t-as="line">
                                    <tr style="border-bottom:1px solid black;">
                                        <t t-set="total_line_gross" t-value="line.product_id.weight * line.quantity"/>
                                        <t t-set="total_line_net" t-value="line.product_id.net_weight * line.quantity"/>

                                        <t t-set="total_gross" t-value="total_gross+total_line_gross"/>
                                        <t t-set="total_net" t-value="total_net+total_line_net"/>
                                        <t t-set="total_boxes" t-value="total_boxes+line.quantity"/>

                                        <t t-if="line.container_no and line.container_no not in unique_containers">
                                            <t t-set="unique_containers" t-value="unique_containers + [line.container_no]"/>
                                        </t>

                                        <td>
                                            <t t-esc="line.container_no"/>
                                        </td>
                                        <td>
                                            <t t-esc="line.quantity"/>
                                        </td>
                                        <td>
                                            <t t-esc="line.pantera_product_box_id.name"/>
                                        </td>
                                        <td>
                                            <t t-esc="line.product_id.name"/>
                                        </td>
                                        <td>
                                            <t t-esc="line.pantera_product_variety_id.name"/>
                                        </td>
                                        <td>
                                            <t t-esc="line.product_id.weight"/>
                                        </td>
                                        <td>
                                            <t t-esc="total_line_gross"/>
                                        </td>
                                        <td>
                                            <t t-esc="line.product_uom_id.name"/>
                                        </td>
                                        <td>
                                            <t t-esc="line.product_id.net_weight"/>
                                        </td>
                                        <td>
                                            <t t-esc="total_line_net"/>
                                        </td>
                                        <td>
                                            <t t-esc="line.product_uom_id.name"/>
                                        </td>
                                    </tr>
                                </t>
                                <tr style="border-top:2px solid black;font-weight:bold;">
                                    <td colspan="6" style="text-align:right;">
                                        <strong>Totals:</strong>
                                    </td>
                                    <td>
                                        <t t-esc="total_gross"/>
                                    </td>
                                    <td/>
                                    <td/>
                                    <td>
                                        <t t-esc="total_net"/>
                                    </td>
                                    <td/>
                                </tr>
                            </table>
                        </div>

                        <!-- Summary Section -->
                        <div class="row" style="margin-top:20px;">
                            <table style="border:1px solid black;width:50%;">
                                <tr style="background-color:#f0f0f0;">
                                    <td colspan="2" style="border:1px solid black;padding:8px;text-align:center;">
                                        <strong>Summary</strong>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="border:1px solid black;padding:8px;width:60%;">
                                        <strong>Total Number of Boxes:</strong>
                                    </td>
                                    <td style="border:1px solid black;padding:8px;text-align:right;">
                                        <t t-esc="int(total_boxes)"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="border:1px solid black;padding:8px;">
                                        <strong>Total Number of Containers:</strong>
                                    </td>
                                    <td style="border:1px solid black;padding:8px;text-align:right;">
                                        <t t-esc="len(unique_containers)"/>
                                    </td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </t>
            </t>
        </template>

        <template id="report_packing_pantera">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="pantera_invoice.report_packing_pantera_document"/>
                </t>
            </t>
        </template>


        <record id="action_report_packing_pantera" model="ir.actions.report">
            <field name="name">Pantera Packing List</field>
            <field name="model">account.move</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">pantera_invoice.report_packing_pantera</field>
            <field name="report_file">pantera_invoice.report_packing_pantera</field>
            <field name="print_report_name">'Packing List - %s' % (object.name)</field>
            <field name="paperformat_id" ref="pantera_invoice.paperformat_report_packing_pantera"/>
            <field name="binding_model_id" ref="account.model_account_move"/>
            <field name="binding_type">report</field>
        </record>


    </data>
</odoo>